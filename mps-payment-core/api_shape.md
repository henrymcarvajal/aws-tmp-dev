# API for MPS payment-core

Context Path : payment port: 9072 version: 1.0

**Important** All the operations required authentication http header (token).

## Resource : Merchant ##

All the resources are protected by token so the header must exist

Merchant represents all the information related to seller.

1. Description: Create merchant if not exists.
- **Http-Method**: Post /merchant
- **Request-Body**:  
```javascript
  {
    name:String,  "name can not be empty or null"
    nit: String,  "nit can not be empty or null"
    email: String, "email can not be empty or null"
    contactNumber: String, "follow pattern $|[0-9]{10})"
    nequiNumber: String    "follow pattern $|[0-9]{10})"
  }
```

- **Response-Body**:  http-code:201 success
                      http-code 400 bad request (incorret inputs)
                      http- code 500 (other errors)

2. Description: Get merchant by Id. Validate if the id of logued user is the same of the GET id
- **Http-Method**: GET /merchant/id
- **Response-Body**:  
```javascript
  {
    nit: String,
    merchantName: String,
    email: String,
    contactNumber: String    
  }
```
In case that merchant does not exist http-code is 404

## Resource : Payment ##

Payment are every transaction generated by a seller.

1. Description: Create payment.
- **Http-Method**: Post /payment
- **Request-Body**:  
```javascript
  {
    idMerchant: String,    "id Merchant can not be null"
    amount: String, "amount can not be null, El valor de la transacci√≥n no puede ser menor a $20.000"    
  }
```

- **Response-Body**:  http-code:201 created
```javascript
  {
    id: "4ef2071c-b207-411c-91d0-8662929f0814",
        idMerchant: "738e98d8-6485-4584-b714-ba1c30f43792",
        idCustomer: null,
        amount: 130000,
        creationDate: null,
        modificationDate: "2020-08-15T15:22:41.898911",
        idState: 1,
        nequiId: null
  }
```

2. Description: Get payment by Id. Validate if the id of logued user is the same of merchant id or the buyer id. Ask identification number in case of buyer.
- **Http-Method**: GET /payment/$id
- **Response-Body**:  
```javascript
  {
    id: "6363d12f-3878-476f-8889-33b80af8e3f7",
    idMerchant: "738e98d8-6485-4584-b714-ba1c30f43792",
    idCustomer: "f2bb348d-b856-4dc7-969f-4cfd3b81f51c",
    amount: 120000,
    creationDate: null,
    modificationDate: "2020-08-12T11:46:41.156571",
    idState: 2,
    nequiId: null
  }
```

3. Description: Partial update for a state of Payment
- **Http-Method**: PATCH /updateState
- **Request-Body**:  
```javascript
  {
    paymentId:String, "payment id is mandatory"
    state: String     "invalid state, only for update to AGREED and DISPUTED, other cases are not allowed"
  }
```

states:  INITIAL(1),
            AGREED(2),
            PAID(3),
            SHIPPED(4),
            DISPUTED(5),
            CLOSED(6)
            

- **Response-Body**:  http code 200
```javascript
  {
   id: "6363d12f-3878-476f-8889-33b80af8e3f7",
   idMerchant: "738e98d8-6485-4584-b714-ba1c30f43792",
   idCustomer: "f2bb348d-b856-4dc7-969f-4cfd3b81f51c",
   amount: 120000,
   creationDate: null,
   modificationDate: "2020-08-12T11:46:41.156571",
   idState: 2,
   nequiId: null
  }
```
4. Description: Agree payment. It happens when buyer fill his form for completing payment. At the end the state of payment will be PAYED
- **Http-Method**: Post /agree
- **Request-Body**:  
```javascript
{
        idPayment:"6363d12f-3878-476f-8889-33b80af8e3f7",
        customer:
        {
        	id:"",
        	name:"Leonardo", 
        	lastName:"Espinosa",
        	email:"jorjek4@hotmail.com",
        	contactNumber:"3212830910",
            nequiNumber: "3998764643", 
            numberId:"1018428677"
        }
}
```
5. Description: Get payments of a Merchant
- **Http-Method**: GET /payment/$merchantId
- **Response-Body**:  
```javascript
  [
      {
          "id": "a0c6bba4-3755-45de-b70f-05d478edab0d",
          "idMerchant": "007bb329-8d26-4acd-b30c-ed6ee3ff8f9f",
          "idCustomer": null,
          "amount": 100000,
          "creationDate": null,
          "modificationDate": "2020-07-29T14:49:55.709023",
          "idState": 1,
          "nequiId": null
      },
      {
          "id": "a5aacacd-48f8-4665-b8ee-5c695dde842b",
          "idMerchant": "007bb329-8d26-4acd-b30c-ed6ee3ff8f9f",
          "idCustomer": "f2bb348d-b856-4dc7-969f-4cfd3b81f51c",
          "amount": 100000,
          "creationDate": "2020-07-29T06:55:31.48113",
          "modificationDate": "2020-07-29T06:55:31.48113",
          "idState": 5,
          "nequiId": null
      }
  ]
```